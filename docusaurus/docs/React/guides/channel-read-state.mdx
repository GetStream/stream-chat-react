---
id: channel_read_state
sidebar_position: 19
title: Channel Read State
keywords: [channel, channel read, channel read state, message read state]
---

This guide intends to provide an overview how channel read state is handled by default in the SDK and how to customize this behavior to our liking.

## The model

The read state is extracted from the channel query response, specifically from each `ChannelResponse` object's `read` attribute. This is internally transformed from array of users' read statuses into and object indexed by user id. Each value of the `read` state object has the following structure:

| Property                    | Type                    | Description                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **last_read**               | `Date`                  | Date when the channel was marked read the last time. The value is provided with `ChannelResponse` when querying channels.                                                                                                                                                                                                                     |
| **unread_messages**         | `number`                | The count of unread messages in a given channel for a given user. The value is provided with `ChannelResponse` when querying channels.                                                                                                                                                                                                        |
| **user**                    | `user`                  | Data of a user, whose read state is described in this object. The value is provided with `ChannelResponse` when querying channels.                                                                                                                                                                                                            |
| **first_unread_message_id** | `string` or `undefined` | The ID of the first message authored by another user not read by the user described in the `user` property. Useful for placing UI around the given message in a message list. **This value is populated only for the logged in user.** This value is calculated by the `StreamChat` client or provided with `notification.mark_unread` event. |
| **last_read_message_id**    | `string` or `undefined` | The ID of the last message authored by another user read by the user described in the `user` property. The value is provided with `ChannelResponse` when querying channels.                                                                                                                                                                   |

In the SDK, the `read` state can be accessed via [`useChannelStateContext` consumer](../../components/contexts/channel_state_context#read):

```tsx
import { useChannelStateContext, useChatContext } from 'stream-chat-react';

const Component = (props) => {
    const { client } = useChatContext();
    const { read, channel } = useChannelStateContext();

    // channel read state for some user
    const channelReadStateForAUser = read[props.user.id];

    // channel read state for own user
    const channelReadStateForMyUser = client.user && read[client.user.id];

    // easier way to access own user's unread count for a given channel
    const unreadCount = channel.unreadCount();

    //... code
};
```

Channel can be marked read using the `markRead()` function provided via `ChannelActionContext`:

```tsx
import { useChannelActionContext } from 'stream-chat-react';

const MarkReadButton = (props) => {
    const { markRead } = useChannelActionContext();

    return <button {...props} onClick={markRead}>Mark read</button>
};
```

:::important
Please, prefer using the `markRead()` function everywhere in the `Channel` context as this function throttles the API calls thus preventing you from hitting the API limit of mark-read calls.
:::

## Default components involved in handling read state

The default components included in **marking a channel read**:

| Component                                                                                                                                     | Description                                                                                                                                                                     |
|-----------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`Channel`](../../components/core-components/channel)                                                                                         | Can be configured to mark active channel read when mounted. This can be done through its prop `markReadOnMount`. By default disabled.                                           |
| [`ChannelPreviewMessenger`](../../components/utility-components/channel_preview_ui)                                                           | Can be configured to mark active channel read when clicked (leaving the active channel). This cane be done through a prop `markActiveChannelReadOnClick`. By default enabled.   |
| [`MessageList`](../../components/core-components/message_list), [`VirtualizedMessageList`](../../components/core-components/virtualized_list) | Can be configured to mark channel read when message list is scrolled to the bottom. This can be done through the list's prop `markReadOnScrolledToBottom`. By default disabled. |
| [`UnreadMessagesNotification`](../../components/contexts/component_context#unreadmessagesnotification)                                        | Floating notification rendered in the message list. Contains a button, which when clicked, marks the channel read.                                                              |

The default components included in **marking a channel unread**:

| Component                                                                                 | Description                                                                                                                                                                                                                                                                                 |
|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`MessageActionsBox`](../../components/message-components/message_ui#message-actions-box) | Action `Mark as Unread` is displayed if a user has `read-events` permission and the actions are displayed for a non-thread message posted by another user. Message which id matches that of the current user's read state's `first_unread_message_id` is not shown option `Mark as Unread`. |

The default components reflecting channel unread count:

| Component                                                                                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|
| [`ChannelPreviewMessenger`](../../components/utility-components/channel_preview_ui)                                                      |
| [`UnreadMessagesSeparator`](../../components/contexts/component_context#unreadmessagesseparator)                                         |
| [`UnreadMessagesNotification`](../../components/contexts/component_context#unreadmessagesnotification)                                   |
| [`ScrollToBottomButton`](https://github.com/GetStream/stream-chat-react/blob/master/src/components/MessageList/ScrollToBottomButton.tsx) |

:::note
Message threads do not participate in handling read state of a channel. Thread replies are not observed for unread count. Therefore, none of the UI components related to read state are rendered in threads.
:::

## Default channel read state handling

The channel is marked read in the following scenarios:

1. User clicks the default `ChannelPreview` UI component to leave an active channel. The channel being left is marked read.
2. User clicks the button on the default `UnreadMessagesNotification` component to mark channel read.

The channel is marked unread in the following scenarios:

1. User with `read-events` permission selects `Mark as unread` option from the `MessageActionsBox`.


## Channel read state handling customization

### Customization through component props

There is a possibility to configure when a channel is marked read by tweaking these default components' props:

| Component                                                                                                                                     | Prop                                                |
|-----------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| [`Channel`](../../components/core-components/channel)                                                                                         | `markReadOnMount` (by default disabled)             |
| [`ChannelPreviewMessenger`](../../components/utility-components/channel_preview_ui)                                                           | `markActiveChannelReadOnClick` (by default enabled) |
| [`MessageList`](../../components/core-components/message_list), [`VirtualizedMessageList`](../../components/core-components/virtualized_list) | `markReadOnScrolledToBottom` (by default disabled)  |

And so instead of marking a channel read when leaving the given channel, the channel can be marked read when scrolled to the bottom or even when mounted.

To disable marking channel read when `ChannelPreview` is clicked, we need to provide a custom `Preview` component that renders the default:

```tsx
import {
    ChannelList,
    ChannelPreviewMessenger,
    ChannelPreviewUIComponentProps
} from 'stream-chat-react';

const Preview = (props: ChannelPreviewUIComponentProps) =>
    <ChannelPreviewMessenger {...props} markActiveChannelReadOnClick={false}/>

const Sidebar = () => (
    <ChannelList filters={filters} sort={sort} options={options} Preview={Preview}/>
);
```

### Customization through custom components

Aside from the custom `Preview` component, we can override the following components via `Channel`'s component context:

#### Custom `UnreadMessagesSeparator` component

Will be rendered before the first unread message.

```tsx
import {
    Channel,
    UnreadMessagesSeparatorProps,
} from 'stream-chat-react';

const UnreadMessagesSeparator = (props: UnreadMessagesSeparatorProps) => {
    //... custom implementation
}
const Component = ({children}) => (
    <Channel UnreadMessagesSeparator={UnreadMessagesSeparator}>
        {children}
    </Channel>
);
```

#### Custom `UnreadMessagesNotification` component

Will be rendered only when being scrolled to unread messages in a message list. The default implementation positions the notification as a floating element above the messages in a message list.

```tsx
import {
    Channel,
    UnreadMessagesNotificationProps,
} from 'stream-chat-react';

const UnreadMessagesNotification = (props: UnreadMessagesNotificationProps) => {
    //... custom implementation
}
const Component = ({children}) => (
    <Channel UnreadMessagesNotification={UnreadMessagesNotification}>
        {children}
    </Channel>
);
```

#### Custom `MessageNotification` component

The SDK exports [`ScrollToBottomButton`](https://github.com/GetStream/stream-chat-react/blob/master/src/components/MessageList/ScrollToBottomButton.tsx) that shows the unread count and is rendered only when scrolled away from the bottom of the message list. We can however implement our own message notification component.

```tsx
import {
    MessageNotificationProps,
    Channel,
} from 'stream-chat-react';

const MessageNotification = (props: MessageNotificationProps) => {
    //... custom implementation
};

const Component = ({children}) => (
    <Channel MessageNotification={MessageNotification} >
        {children}
    </Channel>
);
```